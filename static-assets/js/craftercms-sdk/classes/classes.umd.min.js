!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("rxjs"),require("rxjs/operators"),require("@craftercms/utils"),require("@craftercms/models"),require("rxjs/ajax")):"function"==typeof define&&define.amd?define("@craftercms/classes",["exports","rxjs","rxjs/operators","@craftercms/utils","@craftercms/models","rxjs/ajax"],factory):factory(((global=global||self).craftercms=global.craftercms||{},global.craftercms.classes={}),global.rxjs,global.rxjs.operators,global.craftercms.utils,global.craftercms.models,global.rxjs.ajax)}(this,function(exports,rxjs,operators,utils,models,ajax){"use strict";var Messenger=function(){function Messenger(){var _this=this;this.targets=[],this.origins=[];var multiCaster=new rxjs.Subject,messages=rxjs.fromEvent(window,"message").pipe(operators.tap(function(event){return!_this.originAllowed(event.origin)&&console.log("Messenger: Message received from a disallowed origin.",event)}),operators.filter(function(event){return _this.originAllowed(event.origin)&&"object"==typeof event.data&&"topic"in event.data&&"data"in event.data&&"scope"in event.data}),operators.map(function(event){return{topic:event.data.topic,data:event.data.data,scope:event.data.scope||models.MessageScope.Broadcast}}),operators.multicast(multiCaster),operators.refCount());this.messages$=messages,this.multiCaster$=multiCaster}return Messenger.prototype.subscribe=function(observerOrNext){for(var operators=[],_i=1;_i<arguments.length;_i++)operators[_i-1]=arguments[_i];return this.messages$.pipe.apply(this.messages$,operators).subscribe(observerOrNext)},Messenger.prototype.subscribeTo=function(topic,subscriber,scope){for(var operations=[],_i=3;_i<arguments.length;_i++)operations[_i-3]=arguments[_i];var ops=[];return utils.notNullOrUndefined(scope)?ops.push(operators.filter(function(message){return message.topic===topic})):ops.push(operators.filter(function(message){return message.scope===scope&&message.topic===topic})),this.messages$.pipe.apply(this.messages$,ops.concat(operations)).subscribe(subscriber)},Messenger.prototype.addTarget=function(target){this.removeTarget(target),this.targets.push(target)},Messenger.prototype.resetTargets=function(){this.targets=[]},Messenger.prototype.removeTarget=function(target){this.targets=this.targets.filter(function(item){return item!==target})},Messenger.prototype.addOrigin=function(origin){this.removeOrigin(origin),this.origins.push(origin)},Messenger.prototype.resetOrigins=function(){this.origins=[]},Messenger.prototype.removeOrigin=function(origin){this.origins=this.origins.filter(function(item){return item!==origin})},Messenger.prototype.publish=function(topicOrMessage,data,scope){var message;switch(void 0===data&&(data=null),void 0===scope&&(scope=models.MessageScope.Broadcast),message="string"==typeof topicOrMessage&&topicOrMessage in models.MessageTopic?{topic:topicOrMessage,data:data,scope:scope}:topicOrMessage,scope){case models.MessageScope.Local:this.multiCaster$.next(message);break;case models.MessageScope.External:this.sendMessage(message);break;case models.MessageScope.Broadcast:this.multiCaster$.next(message),this.sendMessage(message)}},Messenger.prototype.sendMessage=function(message,targetOrigin){var _this=this;void 0===targetOrigin&&(targetOrigin="*"),this.targets.forEach(function(target){target.postMessage||(target=target.contentWindow),target&&target.postMessage?target.postMessage(message,targetOrigin):_this.removeTarget(target)})},Messenger.prototype.originAllowed=function(origin){for(var origins=this.origins,i=0,l=origins.length;i<l;++i)if(origins[i]===origin)return!0;return!1},Messenger}(),commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function httpGet(requestURL,params){void 0===params&&(params={});var searchParams=new URLSearchParams(params);return ajax.ajax.get(requestURL+"?"+searchParams.toString()).pipe(operators.pluck("response"))}function httpPost(requestURL,body){return void 0===body&&(body={}),ajax.ajax.post(requestURL,body,{"Content-Type":"application/json"}).pipe(operators.pluck("response"))}!function(self){var ampersandTest,nativeURLSearchParams=self.URLSearchParams&&self.URLSearchParams.prototype.get?self.URLSearchParams:null,isSupportObjectConstructor=nativeURLSearchParams&&"a=1"===new nativeURLSearchParams({a:1}).toString(),decodesPlusesCorrectly=nativeURLSearchParams&&"+"===new nativeURLSearchParams("s=%2B").get("s"),__URLSearchParams__="__URLSearchParams__",encodesAmpersandsCorrectly=!nativeURLSearchParams||((ampersandTest=new nativeURLSearchParams).append("s"," &"),"s=+%26"===ampersandTest.toString()),prototype=URLSearchParamsPolyfill.prototype,iterable=!(!self.Symbol||!self.Symbol.iterator);if(!(nativeURLSearchParams&&isSupportObjectConstructor&&decodesPlusesCorrectly&&encodesAmpersandsCorrectly)){prototype.append=function(name,value){appendTo(this[__URLSearchParams__],name,value)},prototype.delete=function(name){delete this[__URLSearchParams__][name]},prototype.get=function(name){var dict=this[__URLSearchParams__];return name in dict?dict[name][0]:null},prototype.getAll=function(name){var dict=this[__URLSearchParams__];return name in dict?dict[name].slice(0):[]},prototype.has=function(name){return name in this[__URLSearchParams__]},prototype.set=function(name,value){this[__URLSearchParams__][name]=[""+value]},prototype.toString=function(){var i,key,name,value,dict=this[__URLSearchParams__],query=[];for(key in dict)for(name=encode(key),i=0,value=dict[key];i<value.length;i++)query.push(name+"="+encode(value[i]));return query.join("&")};var useProxy=!!decodesPlusesCorrectly&&nativeURLSearchParams&&!isSupportObjectConstructor&&self.Proxy;Object.defineProperty(self,"URLSearchParams",{value:useProxy?new Proxy(nativeURLSearchParams,{construct:function(target,args){return new target(new URLSearchParamsPolyfill(args[0]).toString())}}):URLSearchParamsPolyfill});var USPProto=self.URLSearchParams.prototype;USPProto.polyfill=!0,USPProto.forEach=USPProto.forEach||function(callback,thisArg){var dict=parseToDict(this.toString());Object.getOwnPropertyNames(dict).forEach(function(name){dict[name].forEach(function(value){callback.call(thisArg,value,name,this)},this)},this)},USPProto.sort=USPProto.sort||function(){var k,i,j,dict=parseToDict(this.toString()),keys=[];for(k in dict)keys.push(k);for(keys.sort(),i=0;i<keys.length;i++)this.delete(keys[i]);for(i=0;i<keys.length;i++){var key=keys[i],values=dict[key];for(j=0;j<values.length;j++)this.append(key,values[j])}},USPProto.keys=USPProto.keys||function(){var items=[];return this.forEach(function(item,name){items.push(name)}),makeIterator(items)},USPProto.values=USPProto.values||function(){var items=[];return this.forEach(function(item){items.push(item)}),makeIterator(items)},USPProto.entries=USPProto.entries||function(){var items=[];return this.forEach(function(item,name){items.push([name,item])}),makeIterator(items)},iterable&&(USPProto[self.Symbol.iterator]=USPProto[self.Symbol.iterator]||USPProto.entries)}function URLSearchParamsPolyfill(search){((search=search||"")instanceof URLSearchParams||search instanceof URLSearchParamsPolyfill)&&(search=search.toString()),this[__URLSearchParams__]=parseToDict(search)}function encode(str){var replace={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(str).replace(/[!'\(\)~]|%20|%00/g,function(match){return replace[match]})}function decode(str){return decodeURIComponent(str.replace(/\+/g," "))}function makeIterator(arr){var iterator={next:function(){var value=arr.shift();return{done:void 0===value,value:value}}};return iterable&&(iterator[self.Symbol.iterator]=function(){return iterator}),iterator}function parseToDict(search){var dict={};if("object"==typeof search)for(var key in search)search.hasOwnProperty(key)&&appendTo(dict,key,search[key]);else{0===search.indexOf("?")&&(search=search.slice(1));for(var pairs=search.split("&"),j=0;j<pairs.length;j++){var value=pairs[j],index=value.indexOf("=");-1<index?appendTo(dict,decode(value.slice(0,index)),decode(value.slice(index+1))):value&&appendTo(dict,decode(value),"")}}return dict}function appendTo(dict,name,value){var val="string"==typeof value?value:null!==value&&void 0!==value&&"function"==typeof value.toString?value.toString():JSON.stringify(value);name in dict?dict[name].push(val):dict[name]=[val]}}(void 0!==commonjsGlobal?commonjsGlobal:"undefined"!=typeof window?window:commonjsGlobal);var SDKService={httpGet:httpGet,httpPost:httpPost},__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},DEFAULTS={site:"",baseUrl:"",searchId:null,endpoints:{GET_ITEM_URL:"/api/1/site/content_store/item.json",GET_DESCRIPTOR:"/api/1/site/content_store/descriptor.json",GET_CHILDREN:"/api/1/site/content_store/children.json",GET_TREE:"/api/1/site/content_store/tree.json",GET_NAV_TREE:"/api/1/site/navigation/tree.json",GET_BREADCRUMB:"/api/1/site/navigation/breadcrumb.json",TRANSFORM_URL:"/api/1/site/url/transform.json",SEARCH:"crafter-search/api/2/search/search.json",ELASTICSEARCH:"api/1/site/elasticsearch/search"},contentTypeRegistry:{}},crafterConf=new(function(){function ConfigManager(){this.config=__assign({},DEFAULTS),this.config$=new rxjs.BehaviorSubject(__assign({},DEFAULTS))}return ConfigManager.prototype.publishConfig=function(config){this.config=__assign({},config),this.config$.next(__assign({},config))},ConfigManager.prototype.subscribe=function(observerOrNext){for(var operators=[],_i=1;_i<arguments.length;_i++)operators[_i-1]=arguments[_i];return this.config$.pipe.apply(this.config$,operators).subscribe(observerOrNext)},ConfigManager.prototype.entry=function(propPath,nextValue){var _a,config=this.config;if(!propPath)return __assign({},config);var getter=null==nextValue,path=propPath.split("."),prop=!getter&&path.pop(),value=function(){try{var l_1=path.length-1;return path.length?path.reduce(function(cfg,property,i){return getter&&l_1===i&&utils.isPlainObject(cfg[property])?__assign({},cfg[property]):cfg[property]},config):config}catch(e){return utils.log("Error retrieving crafter config prop '"+propPath+"': "+(e.message||e),utils.log.WARN),null}}();if(getter)return value;(prop in value||"contentTypeRegistry"===path[path.length-1])&&this.publishConfig(__assign(__assign({},value),((_a={})[prop]=nextValue,_a)))},ConfigManager.prototype.getConfig=function(){return __assign({},this.config)},ConfigManager.prototype.mix=function(mixin){return void 0===mixin&&(mixin={}),__assign(__assign({},this.config),mixin)},ConfigManager.prototype.configure=function(nextConfig){var newConfig=utils.extendDeepExistingProps(__assign({},this.config),nextConfig);this.publishConfig(newConfig)},ConfigManager}());exports.Messenger=Messenger,exports.SDKService=SDKService,exports.crafterConf=crafterConf,exports.httpGet=httpGet,exports.httpPost=httpPost,Object.defineProperty(exports,"__esModule",{value:!0})});