!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("@craftercms/classes"),require("@craftercms/utils")):"function"==typeof define&&define.amd?define("@craftercms/content",["exports","@craftercms/classes","@craftercms/utils"],factory):factory(((global=global||self).craftercms=global.craftercms||{},global.craftercms.content={}),global.craftercms.classes,global.craftercms.utils)}(this,function(exports,classes,utils){"use strict";function getItem(path,config){config=classes.crafterConf.mix(config);var requestURL=utils.composeUrl(config,config.endpoints.GET_ITEM_URL);return classes.SDKService.httpGet(requestURL,{url:path,crafterSite:config.site})}function getDescriptor(path,config){config=classes.crafterConf.mix(config);var requestURL=utils.composeUrl(config,config.endpoints.GET_DESCRIPTOR);return classes.SDKService.httpGet(requestURL,{url:path,crafterSite:config.site,flatten:Boolean(config.flatten)})}function getChildren(path,config){config=classes.crafterConf.mix(config);var requestURL=utils.composeUrl(config,config.endpoints.GET_CHILDREN);return classes.SDKService.httpGet(requestURL,{url:path,crafterSite:config.site})}function getTree(path,depth,config){void 0===depth&&(depth=1),"object"==typeof depth&&(config=depth,depth=1),config=classes.crafterConf.mix(config);var requestURL=utils.composeUrl(config,config.endpoints.GET_TREE);return classes.SDKService.httpGet(requestURL,{url:path,depth:depth,crafterSite:config.site})}var ContentStoreService={getItem:getItem,getDescriptor:getDescriptor,getChildren:getChildren,getTree:getTree};function getNavTree(path,depth,currentPageUrl,config){void 0===depth&&(depth=1),void 0===currentPageUrl&&(currentPageUrl=""),config=classes.crafterConf.mix(config);var requestURL=utils.composeUrl(config,config.endpoints.GET_NAV_TREE);return classes.SDKService.httpGet(requestURL,{crafterSite:config.site,currentPageUrl:currentPageUrl,url:path,depth:depth})}function getNavBreadcrumb(path,root,config){void 0===root&&(root=""),config=classes.crafterConf.mix(config);var requestURL=utils.composeUrl(config,config.endpoints.GET_BREADCRUMB);return classes.SDKService.httpGet(requestURL,{crafterSite:config.site,url:path,root:root})}var NavigationService={getNavTree:getNavTree,getNavBreadcrumb:getNavBreadcrumb};function urlTransform(transformerName,url,config){config=classes.crafterConf.mix(config);var requestURL=utils.composeUrl(config,config.endpoints.TRANSFORM_URL);return classes.SDKService.httpGet(requestURL,{crafterSite:config.site,transformerName:transformerName,url:url})}var UrlTransformationService={transform:urlTransform,urlTransform:urlTransform},__assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},systemPropMap={guid:"id",cmsId:"id",objectId:"id",localId:"path","file-name":"fileName",file__name:"fileName",placeInNav:"placeInNav","internal-name":"label",internal__name:"label","content-type":"contentTypeId",content__type:"contentTypeId",createdDate_dt:"dateCreated",lastModifiedDate_dt:"dateModified",disabled:"disabled"},ignoreProps=["orderDefault_f","merge-strategy","display-template","objectGroupId","folder-name","createdDate","lastModifiedDate","no-template-required"],systemProps=Object.keys(systemPropMap).concat(Object.values(systemPropMap));function parseDescriptor(data){if(null==data)return null;if(Array.isArray(data))return data.map(function(item){return parseDescriptor(item)});if(data.children)return parseDescriptor(function extractChildren(children){return children.flatMap(function(child){return child.children?extractChildren(child.children):child})}(data.children));if(null===data.descriptorDom&&data.descriptorUrl)throw new Error("[parseDescriptor] Invalid descriptor supplied. Did you call parseDescriptor with a `getChildren` API response? The `getChildren` API response may contain certain items that are not parsable into ContentInstances. Try a different API (getItem, getDescriptor or getTree) or filter out the metadata items which descriptorDom property has a `page` or `component` property with the content item.");return parseProps(function(data){var output=data;if(data.descriptorDom)return __assign(__assign({},data.descriptorDom.page||data.descriptorDom.component),{path:data.url});if(data.page)return data.page;if(data.component)return data.component;return output}(data),{craftercms:{id:null,path:null,label:null,contentTypeId:null,dateCreated:null,dateModified:null,sourceMap:{}}})}function parseProps(props,parsed){return void 0===parsed&&(parsed={}),Object.entries(props).forEach(function(_a){var _b,_c,prop=_a[0],value=_a[1];ignoreProps.includes(prop)||((null===value||void 0===value?void 0:value["crafter-source-content-type-id"])&&(parsed.craftercms.sourceMap[prop]=value["crafter-source-content-type-id"],"string"==typeof value.text?value=value.text:2===Object.keys(value).length&&(value=null)),systemProps.includes(prop)?parsed.craftercms[null!==(_b=systemPropMap[prop])&&void 0!==_b?_b:prop]=value:prop.endsWith("_o")?(parsed[prop]=null!==(_c=null===value||void 0===value?void 0:value.item)&&void 0!==_c?_c:[],Array.isArray(parsed[prop])||(parsed[prop]=[parsed[prop]]),parsed[prop]=parsed[prop].map(function(item){var key=item.key,value=item.value,component=item.component,include=item.include;return item.component||item.key&&item.value?parseDescriptor(__assign(__assign({label:value},component),{path:(null===key||void 0===key?void 0:key.startsWith("/"))?key:(null===include||void 0===include?void 0:include.startsWith("/"))?include:null})):parseProps(item)})):parsed[prop]=null!==value&&void 0!==value?value:null)}),parsed}var propsToRemove=["rootId","crafterSite","crafterPublishedDate","crafterPublishedDate_dt","inheritsFrom_smv"];exports.ContentStoreService=ContentStoreService,exports.NavigationService=NavigationService,exports.UrlTransformationService=UrlTransformationService,exports.getChildren=getChildren,exports.getDescriptor=getDescriptor,exports.getItem=getItem,exports.getNavBreadcrumb=getNavBreadcrumb,exports.getNavTree=getNavTree,exports.getTree=getTree,exports.parseDescriptor=parseDescriptor,exports.parseProps=parseProps,exports.preParseSearchResults=function preParseSearchResults(source){return Object.entries(source).forEach(function(_a){var prop=_a[0],value=_a[1];if(propsToRemove.includes(prop))delete source[prop];else if(prop.endsWith("_o")){var collection=value;Array.isArray(collection.item)||(source[prop]={item:[collection.item]}),source[prop].item.forEach(function(item,i){source[prop].item[i]=preParseSearchResults(item),item.component&&(source[prop].item[i].component=preParseSearchResults(item.component))})}}),source},exports.urlTransform=urlTransform,Object.defineProperty(exports,"__esModule",{value:!0})});